<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <link rel="stylesheet" href="style.css">
  <title>VoIP UI</title>
  <!-- iOS web app, delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />


  <!-- Mobile IE allows us to activate ClearType technology for smoothing fonts for easy reading -->
  <meta http-equiv="cleartype" content="on">
  <meta name="viewport" content = "width = device-width, initial-scale = 1.0, minimum-scale = 1, maximum-scale = 1, user-scalable = no" />
  <!-- Mobile viewport optimization h5bp.com/ad -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width">

  <!-- App Shortcut Icon -->
    <!-- For third generation iPad Retina Display -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/img/touch/apple-touch-icon-144x144-precomposed.png" />
    <!-- For iPhone 4 with high-resolution Retina display: -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/img/touch/apple-touch-icon-114x114-precomposed.png" />
    <!-- For first-generation iPad: -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/img/touch/apple-touch-icon-72x72-precomposed.png" />
    <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
    <link rel="apple-touch-icon-precomposed" href="/assets/img/touch/apple-touch-icon-57x57-precomposed.png" />
    <!-- For nokia devices: -->
    <link rel="shortcut icon" href="/assets/img/touch/apple-touch-icon.png" />


  <script type = 'text/javascript' src = "processing.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script>
  // The script prevents links from opening in mobile safari. https://gist.github.com/1042026
  (function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone")
  $(document).ready(function(){
          // iOS web app full screen hacks.
          if(window.navigator.standalone == true) {
                  // make all link remain in web app mode.
                  $('a').click(function() {
                          window.location = $(this).attr('href');
              return false;
                  });
          }
  });
  </script>

</head>

<body>


<div class = 'head'>

  <img id = 'mainAvatar' class='avatar' src = 'img/avatar.png' width = '100' height = '100'>
  <p id="test_status" class='headText'>Test</p>

</div>

  <div id="1">

    <h5>Please listen to the following audio sample, and rate its quality on the scale provided</h5>

    <div class = 'controls'>
      <a href ='#' onclick="loadPage('2'); ringtone.play(); navigator.vibrate(1000); return false;"><div id ='nextButton'><h5 class ='buttonLabel'>Begin Test</h5></div></a>
    </div>
  </div>

  <div id="2" style="display:none" class = 'stimulusArea'>
    <center>
  <canvas id ='scale' data-processing-sources = 'processing_SignalBarv2.pde'></canvas>
</center>
    <div class = 'controls'>
      <a href ='#' onclick="loadPage('3'); ringtone.pause(); navigator.vibrate(0); sample.play(); return false;"><div id ="answerButton"><img class = "phone" src='img/phone_icon_answer.png'></div></a>
      <div id ="declineButton"><img class ='phone' src ='img/phone_icon_decline.png'></div>
    </div>

  </div>

  <div id = "3" style="display:none" class = 'stimulusArea'>

    <p id = 'timer'></p>
    <center>
    <canvas  id = 'scale' data-processing-sources = 'processing_SignalBarv2.pde'></canvas>
  </center>
    <div class = 'controls'>
      <a href = '#' onclick="loadPage('4'); sample.pause (); return false;"><div id ="endCallButton"><img class = 'phone' src='img/phone_icon_decline.png'></div></a>
    </div>


  </div>


  <div id = "4" style="display:none">


    <h5>Please use the scale provided to rate the quality of this sample. Click Next to proceed to the next sample.</h5>
    <div class = 'controls'>
      <a href = '#' onclick="loadPage('1'); updateSession(); return false;"><div id ="nextButton"><h5 class ='buttonLabel'>Next Test</h5></div></a>
    </div>

  </div>



<script>
var names = [
"Michael Matthews", 
"Megan Lawson", 
"Linda Fowler", 
"Joseph Porter", 
"Billy Carroll", 
"Martha Berry", 
"Judy Barnes", 
"Gregory Porter", 
"Jeremy King", 
"Carolyn Philips" ,
"Jose Hanson", 
"Patricia Wood", 

"Michael Matthews", 
"Joseph Porter", 
"Linda Fowler", 
"Megan Lawson", 
"Gregory Porter", 
"Billy Carroll", 
"Martha Berry", 
"Patricia Wood", 
"Judy Barnes", 
"Carolyn Philips" ,
"Jeremy King", 
"Jose Hanson" ];


var audioTrack = [
"M1_HIGH.wav",
"F1_MEDIUM.wav",
"F2_MEDIUM.wav",
"M1_HIGH.wav",
"M1_MEDIUM.wav",
"F1_HIGH.wav",
"F2_MEDIUM.wav",
"M1_LOW.wav",
"M1_MEDIUM.wav",
"F2_HIGH.wav",
"M2_MEDIUM.wav",
"F1_MEDIUM.wav",

"M2_LOW.wav",
"M2_MEDIUM.wav",
"F1_LOW.wav",
"F2_HIGH.wav",
"M2_HIGH.wav",
"M2_LOW.wav",
"F2_LOW.wav",
"F2_LOW.wav",
"F1_LOW.wav",
"F1_HIGH.wav",
"M1_LOW.wav",
"M2_HIGH.wav",];


var avatar = [
"img/avatars/m1.jpg", 
"img/avatars/f1.jpg", 
"img/avatars/f2.jpg", 
"img/avatars/m2.jpg", 
"img/avatars/m3.jpg", 
"img/avatars/f3.jpg", 
"img/avatars/f4.jpg", 
"img/avatars/m4.jpg", 
"img/avatars/m5.jpg", 
"img/avatars/f5.jpg", 
"img/avatars/m6.jpg", 
"img/avatars/f6.jpg",

"img/avatars/m1.jpg", 
"img/avatars/m2.jpg", 
"img/avatars/f1.jpg", 
"img/avatars/f2.jpg", 
"img/avatars/m3.jpg", 
"img/avatars/m4.jpg", 
"img/avatars/f3.jpg", 
"img/avatars/f4.jpg", 
"img/avatars/f5.jpg", 
"img/avatars/f6.jpg", 
"img/avatars/m5.jpg", 
"img/avatars/m6.jpg"];
var sessionNumber = 0;
var sample;
var ringtone;
// enable vibration support
navigator.vibrate = navigator.vibrate || navigator.webkitVibrate || navigator.mozVibrate || navigator.msVibrate;
function loadPage(page) {
  var showDiv = document.getElementById(page).style.display='block';
  if(page == '1')
  {
    document.getElementById('4').style.display='none';
  }
  else {
    var hideDiv = document.getElementById(page-1).style.display='none';
  }
  return false;
}
function updateSession() {
  sessionNumber = sessionNumber + 1;
  if(sessionNumber > names.length){
    sessionNumber = 1;
    alert("You have completed the test, please return the handset.")
  }
  track = audioTrack[sessionNumber-1];
  sample = new Audio('samples/'+track);
  ringtone = new Audio('ringtone.mp3');
  document.getElementById("mainAvatar").src = avatar[sessionNumber-1];
  var headChange = document.getElementById('test_status');
  var pjs = Processing.getInstanceById('scale');
  var value;
  headChange.innerHTML = names[sessionNumber-1];
  if(track.charAt(3) == 'L')
  {
    //Low Quality Animation
  console.log('Low Quality');
  value = 3;
  document.getElementById('scale').id='scalelow';
  }
  else if(track.charAt(3) == 'M')
  {
    //Medium Quality Animation
    console.log('Medium Quality');
    value = 5;
  document.getElementById('scale').id='scalemed';
  }
  else {
    //High Quality Animation
    console.log('High Quality');
    value = 9;
   document.getElementById('scale').id='scalehigh';
} 
}
window.onload = updateSession; 


</script>
<script type="text/processing" data-processing-target="scalelow">
//Declare Variable for the For Loop in setup();
float i;
int bars;
// Variables declared for Animation function
int x = 0;
float y = 0;
int counter = 0;
int timer = 0;

void setup(){
 
  size(500, 500);
  background(14, 61, 52);
  stroke(0);
  fill(9, 39, 33);
  rect(3,3,492,492,20);
// Construct outlines of scale
  for(i = 2; i <=11; i++)
  {
    
      fill(14, 61, 52);
      stroke(3);
      float expo = i*(exp(sqrt(i)));
      rect((i)*35, 380, 20, -1 * expo);


  }


    fill(255);
    textSize(15);
    text("Bad", 70, 400);
    text("Fair", 215, 400);
    text("Excellent", 340, 400);
    textSize(30);
    text("Call Quality", 180, 35);
}

void draw(){
    frameRate(15);
    float randomNum = random(100);
    //Set amount of bars displayed - Low: 3 - Medium: 5 - High: 9
    bars = 3;
    timer = frameCount;
    signalAnimation(timer, bars);
    if(randomNum < 50){
      flashAnimation(timer, randomNum, bars);
    }
    else{
      fill(14, 61, 52);
      stroke(3);
      rect(10*35, 380, 20, -10*(exp(sqrt(10))));
      rect(11*35, 380, 20, -11*(exp(sqrt(11))));
    }
}


void signalAnimation(int count, int barNum){
  
   noStroke();
   float expo = count*(exp(sqrt(count)));
   x = x + 35;
   
   // Draws first five bars
   if((count <= barNum))
   {
     colorDecider(count);
     rect(x, 380, 20, -expo);
   }
    
    
    fill(9, 39, 33);
    noStroke();
    rect(35, 380, 25, -70);
  
}

void flashAnimation(int time, float ran, int barNum){

       //Draw sixth bar based on if remainder of the current Millis count/3 is equal to 0
     if(time >= barNum+1)
     {
      colorDecider(barNum+1);
      rect((barNum+1)*35, 380, 20, -(barNum+1)*(exp(sqrt(barNum+1))));
      if(ran < 20)
      {
         rect((barNum+2)*35, 380, 20, -(barNum+2)*(exp(sqrt(barNum+2)))); 

      }
      else{
        stroke(3);
        fill(14,61, 52);
        rect((barNum+2)*35, 380, 20, -(barNum+2)*(exp(sqrt(barNum+2))));
      }
      }
 
}

void colorDecider(int count){
  
     //Set Color change from Red-Orange after two bars, Orange-Green after four
     if((count > 0) && (count <=3))
     {
       fill(232, 78, 79);
     }
     else if((count > 3) && (count <=5))
     {
      fill(232,152,78);
     }
     else if((count > 5) && (count <=7))
     {
       fill(232, 195, 78);
     }
     else if((count > 7) && (count <=9))
     {
       fill(197, 224,75);
     }
     else if((count > 9) && (count <= 11))
     {
      fill(102, 204, 102);       
     }
  
}
  </script>
<script type="text/processing" data-processing-target="scalemed">
//Declare Variable for the For Loop in setup();
float i;
int bars;
// Variables declared for Animation function
int x = 0;
float y = 0;
int counter = 0;
int timer = 0;

void setup(){
 
  size(500, 500);
  background(14, 61, 52);
  stroke(0);
  fill(9, 39, 33);
  rect(3,3,492,492,20);
// Construct outlines of scale
  for(i = 2; i <=11; i++)
  {
    
      fill(14, 61, 52);
      stroke(3);
      float expo = i*(exp(sqrt(i)));
      rect((i)*35, 380, 20, -1 * expo);


  }


    fill(255);
    textSize(15);
    text("Bad", 70, 400);
    text("Fair", 215, 400);
    text("Excellent", 340, 400);
    textSize(30);
    text("Call Quality", 180, 35);
}

void draw(){
    frameRate(15);
    float randomNum = random(100);
    //Set amount of bars displayed - Low: 3 - Medium: 5 - High: 9
    bars = 5;
    timer = frameCount;
    signalAnimation(timer, bars);
    if(randomNum < 50){
      flashAnimation(timer, randomNum, bars);
    }
    else{
      fill(14, 61, 52);
      stroke(3);
      rect(10*35, 380, 20, -10*(exp(sqrt(10))));
      rect(11*35, 380, 20, -11*(exp(sqrt(11))));
    }
}


void signalAnimation(int count, int barNum){
  
   noStroke();
   float expo = count*(exp(sqrt(count)));
   x = x + 35;
   
   // Draws first five bars
   if((count <= barNum))
   {
     colorDecider(count);
     rect(x, 380, 20, -expo);
   }
    
    
    fill(9, 39, 33);
    noStroke();
    rect(35, 380, 25, -70);
  
}

void flashAnimation(int time, float ran, int barNum){

       //Draw sixth bar based on if remainder of the current Millis count/3 is equal to 0
     if(time >= barNum+1)
     {
      colorDecider(barNum+1);
      rect((barNum+1)*35, 380, 20, -(barNum+1)*(exp(sqrt(barNum+1))));
      if(ran < 20)
      {
         rect((barNum+2)*35, 380, 20, -(barNum+2)*(exp(sqrt(barNum+2)))); 

      }
      else{
        stroke(3);
        fill(14,61, 52);
        rect((barNum+2)*35, 380, 20, -(barNum+2)*(exp(sqrt(barNum+2))));
      }
      }
 
}

void colorDecider(int count){
  
     //Set Color change from Red-Orange after two bars, Orange-Green after four
     if((count > 0) && (count <=3))
     {
       fill(232, 78, 79);
     }
     else if((count > 3) && (count <=5))
     {
      fill(232,152,78);
     }
     else if((count > 5) && (count <=7))
     {
       fill(232, 195, 78);
     }
     else if((count > 7) && (count <=9))
     {
       fill(197, 224,75);
     }
     else if((count > 9) && (count <= 11))
     {
      fill(102, 204, 102);       
     }
  
}
  </script>
<script type="text/processing" data-processing-target="scalehigh">
//Declare Variable for the For Loop in setup();
float i;
int bars;
// Variables declared for Animation function
int x = 0;
float y = 0;
int counter = 0;
int timer = 0;

void setup(){
 
  size(500, 500);
  background(14, 61, 52);
  stroke(0);
  fill(9, 39, 33);
  rect(3,3,492,492,20);
// Construct outlines of scale
  for(i = 2; i <=11; i++)
  {
    
      fill(14, 61, 52);
      stroke(3);
      float expo = i*(exp(sqrt(i)));
      rect((i)*35, 380, 20, -1 * expo);


  }


    fill(255);
    textSize(15);
    text("Bad", 70, 400);
    text("Fair", 215, 400);
    text("Excellent", 340, 400);
    textSize(30);
    text("Call Quality", 180, 35);
}

void draw(){
    frameRate(15);
    float randomNum = random(100);
    //Set amount of bars displayed - Low: 3 - Medium: 5 - High: 9
    bars = 9;
    timer = frameCount;
    signalAnimation(timer, bars);
    if(randomNum < 50){
      flashAnimation(timer, randomNum, bars);
    }
    else{
      fill(14, 61, 52);
      stroke(3);
      rect(10*35, 380, 20, -10*(exp(sqrt(10))));
      rect(11*35, 380, 20, -11*(exp(sqrt(11))));
    }
}


void signalAnimation(int count, int barNum){
  
   noStroke();
   float expo = count*(exp(sqrt(count)));
   x = x + 35;
   
   // Draws first five bars
   if((count <= barNum))
   {
     colorDecider(count);
     rect(x, 380, 20, -expo);
   }
    
    
    fill(9, 39, 33);
    noStroke();
    rect(35, 380, 25, -70);
  
}

void flashAnimation(int time, float ran, int barNum){

       //Draw sixth bar based on if remainder of the current Millis count/3 is equal to 0
     if(time >= barNum+1)
     {
      colorDecider(barNum+1);
      rect((barNum+1)*35, 380, 20, -(barNum+1)*(exp(sqrt(barNum+1))));
      if(ran < 20)
      {
         rect((barNum+2)*35, 380, 20, -(barNum+2)*(exp(sqrt(barNum+2)))); 

      }
      else{
        stroke(3);
        fill(14,61, 52);
        rect((barNum+2)*35, 380, 20, -(barNum+2)*(exp(sqrt(barNum+2))));
      }
      }
 
}

void colorDecider(int count){
  
     //Set Color change from Red-Orange after two bars, Orange-Green after four
     if((count > 0) && (count <=3))
     {
       fill(232, 78, 79);
     }
     else if((count > 3) && (count <=5))
     {
      fill(232,152,78);
     }
     else if((count > 5) && (count <=7))
     {
       fill(232, 195, 78);
     }
     else if((count > 7) && (count <=9))
     {
       fill(197, 224,75);
     }
     else if((count > 9) && (count <= 11))
     {
      fill(102, 204, 102);       
     }
  
}
  </script>
</body>
</html>
